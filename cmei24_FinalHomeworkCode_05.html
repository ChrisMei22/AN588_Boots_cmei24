<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>cmei24_OriginalHomeworkCode_05</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cmei24_FinalHomeworkCode_05_files/libs/clipboard/clipboard.min.js"></script>
<script src="cmei24_FinalHomeworkCode_05_files/libs/quarto-html/quarto.js"></script>
<script src="cmei24_FinalHomeworkCode_05_files/libs/quarto-html/popper.min.js"></script>
<script src="cmei24_FinalHomeworkCode_05_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cmei24_FinalHomeworkCode_05_files/libs/quarto-html/anchor.min.js"></script>
<link href="cmei24_FinalHomeworkCode_05_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cmei24_FinalHomeworkCode_05_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cmei24_FinalHomeworkCode_05_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cmei24_FinalHomeworkCode_05_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cmei24_FinalHomeworkCode_05_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">cmei24_OriginalHomeworkCode_05</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="anbi588-homework-5---boots-for-days" class="level2">
<h2 class="anchored" data-anchor-id="anbi588-homework-5---boots-for-days">AN/BI588 Homework 5 - Boots for Days</h2>
<p>[1] Using the “KamilarAndCooperData.csv” dataset, run a linear regression looking at log(HomeRange_km2) in relation to log(Body_mass_female_mean) and report your \beta coeffiecients (slope and intercept).</p>
<p>[2] Then, use bootstrapping to sample from your data 1000 times with replacement, each time fitting the same model and calculating the same coefficients. This generates a sampling distribution for each \beta coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(curl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using libcurl 8.7.1 with LibreSSL/3.3.6

Attaching package: 'curl'

The following object is masked from 'package:readr':

    parse_date</code></pre>
</div>
</div>
</section>
<section id="loghomerange_km2-vs.-logbody_mass_female_mean" class="level2">
<h2 class="anchored" data-anchor-id="loghomerange_km2-vs.-logbody_mass_female_mean">1 - Log(HomeRange_km2) vs.&nbsp;Log(Body_mass_female_mean)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>KC_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">curl</span>(<span class="at">url =</span> <span class="st">"https://raw.githubusercontent.com/fuzzyatelin/fuzzyatelin.github.io/refs/heads/master/AN588_Spring25/KamilarAndCooperData.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 213 Columns: 44
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (16): Scientific_Name, Family, Genus, Species, Brain_size_Ref, Mass_Ref,...
dbl (28): Brain_Size_Species_Mean, Brain_Size_Female_Mean, Body_mass_male_me...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(KC_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 44
  Scientific_Name             Family        Genus Species Brain_Size_Species_M…¹
  &lt;chr&gt;                       &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                    &lt;dbl&gt;
1 Allenopithecus_nigroviridis Cercopitheci… Alle… nigrov…                   58.0
2 Allocebus_trichotis         Cercopitheci… Allo… tricho…                   NA  
3 Alouatta_belzebul           Atelidae      Alou… belzeb…                   52.8
4 Alouatta_caraya             Atelidae      Alou… caraya                    52.6
5 Alouatta_guariba            Atelidae      Alou… guariba                   51.7
6 Alouatta_palliata           Atelidae      Alou… pallia…                   49.9
# ℹ abbreviated name: ¹​Brain_Size_Species_Mean
# ℹ 39 more variables: Brain_Size_Female_Mean &lt;dbl&gt;, Brain_size_Ref &lt;chr&gt;,
#   Body_mass_male_mean &lt;dbl&gt;, Body_mass_female_mean &lt;dbl&gt;,
#   Mass_Dimorphism &lt;dbl&gt;, Mass_Ref &lt;chr&gt;, MeanGroupSize &lt;dbl&gt;,
#   AdultMales &lt;dbl&gt;, AdultFemale &lt;dbl&gt;, AdultSexRatio &lt;dbl&gt;,
#   Social_Organization_Ref &lt;chr&gt;, InterbirthInterval_d &lt;dbl&gt;, Gestation &lt;dbl&gt;,
#   WeaningAge_d &lt;dbl&gt;, MaxLongevity_m &lt;dbl&gt;, LitterSz &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Create the variables that we need using the <code>mutate()</code> function and use <code>colnames()</code> to make sure that everything looks good!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>KC_data <span class="ot">&lt;-</span> KC_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Log_HomeRange_km2 =</span> <span class="fu">log</span>(HomeRange_km2),</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Log_Body_mass_female_mean =</span> <span class="fu">log</span>(Body_mass_female_mean))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(KC_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Scientific_Name"           "Family"                   
 [3] "Genus"                     "Species"                  
 [5] "Brain_Size_Species_Mean"   "Brain_Size_Female_Mean"   
 [7] "Brain_size_Ref"            "Body_mass_male_mean"      
 [9] "Body_mass_female_mean"     "Mass_Dimorphism"          
[11] "Mass_Ref"                  "MeanGroupSize"            
[13] "AdultMales"                "AdultFemale"              
[15] "AdultSexRatio"             "Social_Organization_Ref"  
[17] "InterbirthInterval_d"      "Gestation"                
[19] "WeaningAge_d"              "MaxLongevity_m"           
[21] "LitterSz"                  "Life_History_Ref"         
[23] "GR_MidRangeLat_dd"         "Precip_Mean_mm"           
[25] "Temp_Mean_degC"            "AET_Mean_mm"              
[27] "PET_Mean_mm"               "Climate_Ref"              
[29] "HomeRange_km2"             "HomeRangeRef"             
[31] "DayLength_km"              "DayLengthRef"             
[33] "Territoriality"            "Fruit"                    
[35] "Leaves"                    "Fauna"                    
[37] "DietRef1"                  "Canine_Dimorphism"        
[39] "Canine_Dimorphism_Ref"     "Feed"                     
[41] "Move"                      "Rest"                     
[43] "Social"                    "Activity_Budget_Ref"      
[45] "Log_HomeRange_km2"         "Log_Body_mass_female_mean"</code></pre>
</div>
</div>
<p>Insert the data and the columns needed into the model and see the coefficients</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>range_body_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> KC_data, Log_HomeRange_km2 <span class="sc">~</span> Log_Body_mass_female_mean)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(range_body_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              (Intercept) Log_Body_mass_female_mean 
                -9.441231                  1.036432 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(range_body_model)[[<span class="dv">2</span>]] <span class="co"># This only shows the beta slope coefficient</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.036432</code></pre>
</div>
</div>
<p>Let’s plot this!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> KC_data, <span class="fu">aes</span>(<span class="at">x =</span> Log_Body_mass_female_mean, <span class="at">y =</span> Log_HomeRange_km2)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cmei24_FinalHomeworkCode_05_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bootstrapping" class="level2">
<h2 class="anchored" data-anchor-id="bootstrapping">2 - Bootstrapping</h2>
<p>We need to see how many total entries we have in the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(KC_data<span class="sc">$</span>Log_Body_mass_female_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 213</code></pre>
</div>
</div>
<p>Let’s assume that we will bootstrap 1000 times using samples of 20 entries with replacement. This number of samples was completely arbitrary but it should be a good starting point to illustrate the bootstrapping.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>beta_collection <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  sample_rows <span class="ot">&lt;-</span> KC_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(KC_data), <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),]<span class="co"># We will bootstrap samples of 20 from the entire sample with replacement</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  sample_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> sample_rows, Log_HomeRange_km2 <span class="sc">~</span> Log_Body_mass_female_mean)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  beta_collection <span class="ot">&lt;-</span> <span class="fu">c</span>(beta_collection, <span class="fu">coef</span>(sample_model)[[<span class="dv">2</span>]]) <span class="co"># Store only the slope term</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>beta_collection</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   [1] 1.0840689 0.7553121 1.6460728 1.3696574 0.9630791 0.8252008 1.4058432
   [8] 0.7903750 1.2449642 1.4299493 1.0469720 1.3516159 0.9329070 0.7036347
  [15] 1.0937745 0.8840941 0.7460434 1.0526409 1.4947277 0.7803779 2.5901667
  [22] 1.3874065 1.2686285 0.5237445 1.6316445 1.2328806 1.4977438 1.0813030
  [29] 1.3199814 1.1965017 1.0029352 1.0522103 1.0390343 1.0496497 0.9216349
  [36] 0.9527527 1.8844127 1.1750846 1.2599276 1.1507099 1.1970717 0.4225700
  [43] 0.9719427 0.9869302 1.1406168 0.2262086 1.1194365 0.8569502 0.7729377
  [50] 0.7993684 2.0785422 1.0135361 0.7663794 0.8270618 2.2067104 1.0667552
  [57] 0.9246030 0.8932537 1.2288074 1.3964717 0.9392060 0.4068062 1.7343661
  [64] 0.9169857 1.2163219 0.5253496 0.5603057 1.2722531 1.1922659 1.2496344
  [71] 1.0324236 1.4612844 0.6968328 0.9281719 1.3277067 1.3082308 1.2201003
  [78] 0.8993710 1.2169469 1.3026661 0.9227676 1.0983713 1.1153503 0.8835856
  [85] 0.8658999 0.6389030 1.4798427 0.6665827 1.0021726 1.3055640 0.9988239
  [92] 0.6052028 0.6244899 2.0541260 1.4517081 0.8805497 1.5104461 1.2688550
  [99] 1.3136561 0.8313369 0.1324004 1.1706890 0.6514286 0.6705316 1.1235690
 [106] 0.8541828 1.1590314 0.2486713 1.5856786 0.9614813 1.3227608 1.0092124
 [113] 0.5420364 0.5483718 1.0140113 0.9346807 0.9016480 0.9295955 0.4137519
 [120] 0.7672317 1.3604965 1.0726607 1.0194490 0.9153496 0.9635090 0.6746296
 [127] 1.7044638 0.8479917 0.9066382 1.0641646 0.2912491 1.1227233 0.9722638
 [134] 0.6216434 0.9462350 0.7837486 0.6718438 1.0077523 1.0916160 0.8925305
 [141] 0.4710513 0.8271096 1.0250262 0.8098374 1.1799977 1.0588646 0.9067222
 [148] 0.6693826 1.0127717 0.5793243 0.7868943 1.2421027 1.2982177 0.9147010
 [155] 1.2890720 0.8870658 1.6046953 0.6879769 0.9210546 0.8998296 0.9963140
 [162] 1.3770019 1.3246328 0.9342139 1.5577420 0.8193254 1.0810020 0.7445299
 [169] 1.9030213 0.6489176 1.1776313 1.1405757 0.9225060 1.2995116 0.7390390
 [176] 0.7677230 0.9027786 0.5343640 0.9409277 0.8713312 0.5314348 1.2580717
 [183] 1.1467344 1.0526790 0.9601590 1.4356727 0.9484577 1.2177992 0.7391563
 [190] 0.9724088 0.8796953 1.1110325 0.9316319 0.9889933 0.6187147 0.8461783
 [197] 0.7320905 1.0231107 1.0404934 1.3579301 0.5267401 0.9140974 1.5047734
 [204] 1.2131330 0.7857250 1.3837376 0.4931563 0.6799217 0.9738602 0.9760820
 [211] 0.9701996 1.2936222 0.9635078 0.6823424 1.0273862 1.0093000 0.8743448
 [218] 1.1450811 0.9709218 1.4153895 0.8865661 1.5562915 1.1979498 1.3824809
 [225] 1.7269183 0.5379486 1.3818269 1.5522479 1.4897166 1.0131079 0.4215558
 [232] 0.7737733 1.0638042 0.9842162 1.3073269 0.9981499 1.2424023 1.3319115
 [239] 1.0111331 1.0899363 1.4516101 0.7253330 1.1182819 1.0627804 0.4965360
 [246] 0.9116754 0.6962389 0.6292357 1.2092053 0.6326381 1.8279008 1.2684914
 [253] 0.9135276 0.9690374 0.8906698 1.2548577 0.9042996 1.3709372 0.8646595
 [260] 1.4872632 0.6915454 0.9526775 1.1257425 0.9394369 1.1969140 0.9942477
 [267] 1.0698756 0.8702301 1.0462858 0.7939763 0.8437067 0.5266542 1.3534464
 [274] 1.0220372 1.0152960 0.9760630 0.7786445 1.1142480 0.4784278 1.5109884
 [281] 1.3946560 1.0079892 0.8975952 1.4652913 0.5650880 1.2313365 0.8919248
 [288] 0.8000882 1.1564874 1.4557444 0.9293641 0.6754983 0.8680123 0.9852652
 [295] 0.9218203 0.9199983 1.0503567 0.6368947 1.0473751 0.6683062 0.8524197
 [302] 1.6126540 0.8585071 1.6297007 1.0010000 1.1131281 1.2645517 1.6879916
 [309] 1.2996493 0.6223042 1.0449916 1.1565247 0.4411108 0.7927872 1.0477267
 [316] 1.1630110 1.1421416 1.0686472 1.1329804 1.5688058 1.3051109 1.0269277
 [323] 1.6959457 0.9132920 1.0010097 0.9664496 0.9044660 1.0304437 0.8095124
 [330] 1.0652106 0.9717623 0.9619566 0.9122811 1.1955154 0.9026676 1.3816226
 [337] 0.7719105 1.2441301 1.3900262 1.1693159 0.8092452 1.5579065 1.1299079
 [344] 1.4155604 1.2107574 1.1154437 0.7274898 0.9003657 1.0845155 0.7688999
 [351] 0.9387106 1.3433092 1.4526281 1.0482321 1.1367346 1.1113002 0.7243617
 [358] 0.8611485 0.6851783 1.1798212 1.7775499 0.8296324 0.9235857 1.2189841
 [365] 1.2805597 0.5452797 1.2478636 0.4492519 0.8242286 0.8509834 1.0034832
 [372] 1.1033107 0.9876533 1.3664451 1.3801579 0.8033360 1.0494553 1.1277588
 [379] 0.6888258 1.1008701 0.7720443 1.5679178 0.8398409 1.1122855 0.6091048
 [386] 1.1629942 1.3482245 1.0686567 0.5904765 1.1520390 0.9674619 0.9081168
 [393] 1.0869334 1.1969903 1.3619336 1.2058736 1.0517086 0.9345702 0.9988555
 [400] 0.8477411 1.0159789 0.7714327 1.9173575 1.1417032 1.4472807 1.0323522
 [407] 0.7390177 0.6244807 1.0492690 1.2847161 1.1756959 0.8542016 1.0073908
 [414] 1.2540013 1.6380583 1.3765814 1.0139476 0.9952000 1.0888889 0.8247922
 [421] 1.0589624 1.2353054 0.9660303 0.9783888 1.0210439 1.5034833 0.9660404
 [428] 0.8169701 1.0908196 1.1376437 0.8269061 1.0556913 1.3048993 1.5855703
 [435] 0.5054093 1.4214615 0.9161359 0.7251585 0.7116406 1.2040641 1.0154689
 [442] 1.2948131 0.9457477 1.0287889 0.8499734 0.3150928 0.9794759 1.0234773
 [449] 1.2588897 0.8255109 1.7269961 0.9769234 0.8581096 1.2368720 0.2515185
 [456] 0.9383038 1.2206908 1.0984409 1.0442957 0.8276824 0.9966423 1.2814498
 [463] 1.0171652 1.2559249 1.4646173 0.7871919 0.8919844 1.0947850 1.0765874
 [470] 1.0766879 0.9740792 1.3144361 1.5382738 1.6289227 0.7967141 0.8931498
 [477] 0.8097067 0.7941959 1.0107200 0.7966919 1.6725084 1.2260121 0.9909804
 [484] 0.9731057 1.1791139 1.3415156 0.8301617 0.9995996 0.9428989 0.8268179
 [491] 1.0936234 0.5311503 1.0300686 0.8542054 1.0965020 0.9234185 0.6789473
 [498] 1.0674757 1.2926097 0.7672839 0.9666912 0.8304418 0.5131972 1.2206349
 [505] 1.4867231 0.7147301 1.6746247 0.9489331 0.8711006 1.0683089 1.0842637
 [512] 1.0690883 1.3967119 0.7476782 1.5571911 0.8147306 0.9700168 0.5149323
 [519] 1.4703258 0.2803160 1.1403861 0.8094874 1.1999959 0.1468879 1.0217075
 [526] 1.0603707 1.2949507 1.3614563 0.5006449 1.1100612 0.7645204 0.9402334
 [533] 0.4499840 1.1621849 0.9264685 0.8144492 1.5130286 1.5038873 0.8847486
 [540] 0.9677203 1.6302657 1.1766072 0.7561341 1.1972814 0.5975231 0.9121847
 [547] 1.2004088 1.3923141 1.1757994 1.5638745 1.4026340 0.9574779 0.7938551
 [554] 0.5573663 0.9498429 1.0809830 1.1291395 0.9388065 1.0866388 0.8535498
 [561] 1.1568224 1.6506676 1.5161203 1.0628039 0.9634806 1.0472322 1.1660025
 [568] 1.7402875 1.1509944 1.2137365 0.7734131 0.7552409 0.6171229 1.2178125
 [575] 1.1954093 1.1757370 1.1080366 0.8812366 1.1317440 0.7123940 1.2343609
 [582] 0.9050363 1.2086110 1.1233385 1.5474463 0.6955625 1.3272173 1.1680378
 [589] 0.9264358 1.0511409 1.1391421 0.9898134 0.8764008 1.2417968 0.9944675
 [596] 0.8807586 0.8897766 0.9943933 0.8018951 1.6245322 0.6829949 0.7887840
 [603] 1.0903492 1.5246004 0.1054751 1.4124934 1.0449267 1.1495373 1.1576975
 [610] 1.1416915 1.1284150 0.6626466 1.0370781 1.1024956 0.9119824 1.1185185
 [617] 0.7010792 1.2058942 0.9469407 1.0820702 1.7379105 1.4766031 1.1287896
 [624] 1.3523169 0.6926811 1.0965393 1.0837620 1.0980595 1.3479168 0.7844226
 [631] 1.7597865 1.0799971 1.1921217 1.2660921 0.6063968 1.3598196 1.1394775
 [638] 1.0656022 1.1418636 0.6660044 0.7952926 0.5538096 1.3025237 1.1174025
 [645] 0.6486998 1.1018695 1.7370472 0.7323087 1.2322037 1.0015589 0.9906809
 [652] 0.7556992 1.1334751 1.3023937 1.1633929 0.6284364 1.2513486 1.1753460
 [659] 1.2610863 0.6523478 1.2297830 0.8117398 0.9250997 1.5330733 0.4998640
 [666] 1.1477133 0.9817013 0.8907427 0.6836723 1.0261745 0.5533068 0.7679521
 [673] 1.7623852 0.8569353 1.1200180 1.4574002 1.1483161 1.0348382 1.2260713
 [680] 0.8195519 1.2233408 0.6028484 1.3555516 0.8330693 0.9041957 0.5555086
 [687] 1.1542640 1.0457628 1.1037165 1.1440437 0.9010370 0.8425619 0.7261310
 [694] 1.0288006 0.7910134 1.1741172 1.3562771 2.7838083 1.0957887 1.3574147
 [701] 0.6761686 0.7899947 1.4421817 1.5751615 0.8973521 0.6733052 0.4610866
 [708] 0.6403956 1.2162984 0.8311930 1.2632849 1.0018195 1.0801545 1.0257937
 [715] 1.6518554 1.0689026 1.3050319 0.5625145 0.8908979 0.5738961 0.9646542
 [722] 0.7953525 1.0660902 0.8751817 0.8794811 0.8316376 1.0466249 1.0356393
 [729] 1.2847375 1.2100785 0.9994823 1.2698295 1.1126256 0.8805739 1.1795513
 [736] 2.1243302 0.7698350 0.4960127 0.5422490 0.7950369 0.8595594 1.5249205
 [743] 0.5496009 1.2647797 1.1802086 0.9767333 1.0034990 1.3225886 0.4941302
 [750] 0.5742426 1.1001109 0.3402476 1.8455957 1.0877897 1.0952709 0.3629238
 [757] 1.3282332 1.2147762 0.8018628 1.1687362 1.3473816 1.0971720 0.9625316
 [764] 0.6930333 1.1418874 0.9810523 0.8536776 1.0479214 1.1122041 1.4244961
 [771] 0.7764061 1.0081898 1.4234204 0.7918140 1.2580745 0.5650823 1.0865432
 [778] 1.4031897 0.8333813 0.9141585 1.1280017 1.2907503 1.0751331 0.9828974
 [785] 1.3232382 1.0960268 1.3971603 0.9380513 1.1529718 1.0218886 0.8398136
 [792] 0.9613364 0.9833521 0.6027931 0.9521608 1.2445653 0.9280804 0.9175054
 [799] 0.9813361 0.9526391 0.8580988 1.0849618 0.7886545 1.8288559 0.8805092
 [806] 1.1064804 0.7593670 0.7836141 1.7440113 1.0600417 0.9898211 1.4243514
 [813] 1.0280733 1.0470062 0.9193400 0.9961967 0.6543900 0.8881202 0.9839329
 [820] 1.0592735 1.0972827 1.1377950 0.9234032 0.7392426 1.5224075 0.7606741
 [827] 1.1063898 0.7953798 1.0167237 0.1735261 0.6903463 1.0370417 1.0743595
 [834] 1.1429035 1.5857990 0.8793086 1.3361322 1.4249508 1.0071322 1.0340139
 [841] 1.0121158 1.5441444 1.5344855 1.2529831 0.8217019 0.8762991 1.1830754
 [848] 1.7855760 0.9089701 0.6803239 0.8351020 0.9939600 1.3582699 0.8494122
 [855] 0.9635890 0.7939415 0.9680915 0.8495634 1.1339479 1.0077411 0.9096343
 [862] 0.9449662 1.1240414 0.9925027 1.3950016 0.8941421 0.9378460 1.2476012
 [869] 1.4307340 1.4044643 1.0940728 1.2499639 1.0483919 1.1365407 0.8187862
 [876] 1.2684391 1.4444168 1.9078798 1.2385960 1.7104091 1.3596231 1.3202584
 [883] 1.6663831 1.2218228 0.7068160 0.9053355 1.3197049 0.8802484 0.9555567
 [890] 0.9108976 0.9178812 1.2317278 0.3276387 1.1084950 1.2562903 1.0524054
 [897] 1.2520120 1.9397620 0.8241349 1.2435870 0.4123845 0.8158540 1.4316641
 [904] 0.7956138 0.6563788 0.7573965 0.2358966 1.3251124 0.8369288 0.5012742
 [911] 0.8151461 1.2392881 0.7926694 1.1679985 1.2685652 1.1620668 1.0943725
 [918] 0.9957647 1.5022832 0.9529490 1.6564385 0.9259820 1.0622964 1.4259966
 [925] 1.3329811 1.4298891 1.2096285 0.9903277 1.1227786 0.9340629 1.2535903
 [932] 1.6563899 0.8880118 1.3733833 1.4392478 1.1020472 0.9883270 1.3606416
 [939] 0.6439824 1.3254020 1.3461955 0.9681246 0.8266831 0.8639031 0.9537210
 [946] 1.0554236 0.9615049 0.7420540 1.0753679 0.7597418 1.4106918 0.8453076
 [953] 1.3411250 1.1045546 1.0923236 0.6307780 1.4898574 1.2988646 1.2978661
 [960] 1.3319758 0.6515544 0.9414819 1.7602601 0.8124835 1.4607838 0.9194387
 [967] 1.1130555 1.1690682 0.9257798 0.6672325 1.6919608 1.1892432 1.7334545
 [974] 0.8957246 1.0272876 1.4760266 0.9507755 0.7130430 1.3609804 1.0140643
 [981] 1.2171244 1.3017666 1.2960167 1.1042190 1.2277043 0.9117665 1.1991520
 [988] 0.9103416 1.6846796 1.0323338 1.4717947 1.1144771 1.4106350 1.3421730
 [995] 0.5026826 0.7886733 1.6110052 0.6704866 0.5930898 0.9266684</code></pre>
</div>
</div>
<p>We can find the average of these bootstrapped beta coefficients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(beta_collection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.050662</code></pre>
</div>
</div>
<p>Estimate the standard error for each of your \beta coefficients as the standard deviation of the sampling distribution from your bootstrap and determine the 95% CI for each of your \beta coefficients based on the appropriate quantiles from your sampling distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>SE_beta <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta_collection)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>SE_beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3147206</code></pre>
</div>
</div>
<p>To get the 95% Confidence interval,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ci_beta <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta_collection, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ci_beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     2.5%     97.5% 
0.4927881 1.7271576 </code></pre>
</div>
</div>
<section id="how-does-the-former-compare-to-the-se-estimated-from-your-entire-dataset-using-the-formula-for-standard-error-implemented-in-lm" class="level3">
<h3 class="anchored" data-anchor-id="how-does-the-former-compare-to-the-se-estimated-from-your-entire-dataset-using-the-formula-for-standard-error-implemented-in-lm">How does the former compare to the SE estimated from your entire dataset using the formula for standard error implemented in <code>lm()</code>?</h3>
<p>To see the SE for the original model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>og_se_beta <span class="ot">&lt;-</span> <span class="fu">summary</span>(range_body_model)<span class="sc">$</span>coefficients[, <span class="st">"Std. Error"</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>og_se_beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              (Intercept) Log_Body_mass_female_mean 
               0.67293459                0.08487709 </code></pre>
</div>
</div>
<p>When it comes to SE, the SE from the bootstrapped method is higher than the original one (entire dataset).</p>
</section>
<section id="how-does-the-latter-compare-to-the-95-ci-estimated-from-your-entire-dataset" class="level3">
<h3 class="anchored" data-anchor-id="how-does-the-latter-compare-to-the-95-ci-estimated-from-your-entire-dataset">How does the latter compare to the 95% CI estimated from your entire dataset?</h3>
<p>To get CI from the original model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>og_ci_beta <span class="ot">&lt;-</span> <span class="fu">confint</span>(range_body_model)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>og_ci_beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                2.5 %    97.5 %
(Intercept)               -10.7720889 -8.110374
Log_Body_mass_female_mean   0.8685707  1.204292</code></pre>
</div>
</div>
<p>Compared to the bootstrapped CI, both values are very similar with the 97.5 quantile being higher in the bootstrapped dataset and the 2.5 quantile being higher in the original dataset.</p>
</section>
</section>
<section id="extra-credit" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit">EXTRA CREDIT</h2>
<p>Write a FUNCTION that takes as its arguments a dataframe, “d”, a linear model, “m” (as a character string, e.g., “logHR~logBM”), a user-defined confidence interval level, “conf.level” (with default = 0.95), and a number of bootstrap replicates, “n” (with default = 1000). Your function should return a dataframe that includes: beta coefficient names; beta coefficients, standard errors, and upper and lower CI limits for the linear model based on your entire dataset; and mean beta coefficient estimates, SEs, and CI limits for those coefficients based on your bootstrap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>lm_bootstrap <span class="ot">&lt;-</span> <span class="cf">function</span>(d, linear_model, m, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">n =</span> <span class="dv">1000</span>){</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First let's set up everything we need from the normal non_bootstrapped model</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  lm_beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(linear_model)[[<span class="dv">2</span>]]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  lm_SE <span class="ot">&lt;-</span> <span class="fu">summary</span>(linear_model)<span class="sc">$</span>coefficients[, <span class="st">"Std. Error"</span>][[<span class="dv">2</span>]]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  lm_CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(linear_model, <span class="at">level =</span> conf.level)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now let's do the bootstrapping</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  beta_bootstrapped <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    sample_rows <span class="ot">&lt;-</span> d[<span class="fu">sample</span>(<span class="fu">nrow</span>(d), <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),]</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    sample_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> sample_rows, <span class="fu">as.formula</span>(m)) <span class="co"># Need to turn string from m as a formula, otherwise it won't work</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    beta_collection <span class="ot">&lt;-</span> <span class="fu">c</span>(beta_collection, <span class="fu">coef</span>(sample_model)[[<span class="dv">2</span>]])</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get what you need from the bootstrapped info</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  boot_beta <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta_collection)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  boot_SE <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta_collection)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  lower_CI <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> conf.level)<span class="sc">/</span><span class="dv">2</span> <span class="co"># To get different quantiles if confidence level is not 0.95</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  upper_CI <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> lower_CI</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  boot_CI <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta_collection, <span class="fu">c</span>(lower_CI, upper_CI))</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Put it all together in a table</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  output_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Values =</span> <span class="fu">c</span>(<span class="st">"beta_coef"</span>, <span class="st">"SE"</span>, <span class="st">"lower_CI"</span>, <span class="st">"upper_CI"</span>),</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Original_lm =</span> <span class="fu">c</span>(lm_beta, lm_SE, lm_CI[<span class="dv">2</span>], lm_CI[<span class="dv">4</span>]),</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">Bootstrapped_lm =</span> <span class="fu">c</span>(boot_beta, boot_SE, boot_CI[[<span class="dv">1</span>]], boot_CI[[<span class="dv">2</span>]])</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_df)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s test it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>test_function <span class="ot">&lt;-</span> <span class="fu">lm_bootstrap</span>(KC_data, range_body_model, <span class="at">m =</span> <span class="st">"Log_HomeRange_km2 ~ Log_Body_mass_female_mean"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>test_function</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Values Original_lm Bootstrapped_lm
1 beta_coef  1.03643151       1.0506619
2        SE  0.08487709       0.3146418
3  lower_CI  0.86857075       0.4927881
4  upper_CI  1.20429228       1.7271576</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>test_function[<span class="dv">1</span>,<span class="dv">3</span>] <span class="co"># This is to get the beta coef from the bootstrapped lm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.050662</code></pre>
</div>
</div>
<p>Everything checks out with what we calculated above!</p>
</section>
<section id="extra-extra-credit" class="level2">
<h2 class="anchored" data-anchor-id="extra-extra-credit">EXTRA EXTRA CREDIT</h2>
<p>Graph each beta value from the linear model and its corresponding mean value, lower CI and upper CI from a bootstrap as a function of number of bootstraps from 10 to 200 by 10s. HINT: the beta value from the linear model will be the same for all bootstraps and the mean beta value may not differ that much!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>n_boot_list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">200</span>, <span class="at">by =</span> <span class="dv">10</span>) <span class="co"># Establish a list of numbers that will go from 10 to 200 in intervals of 10</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>graph_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="co"># Create an empty data frame to add our data to</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_boot =</span> <span class="fu">numeric</span>(),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_coef =</span> <span class="fu">numeric</span>(),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower_CI =</span> <span class="fu">numeric</span>(),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper_CI =</span> <span class="fu">numeric</span>()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> n_boot_list){ <span class="co"># Go through the list of the n_boot_list and use i as the bootstrap sample parameter in the custom lm_bootstrap() function</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  boot_results <span class="ot">&lt;-</span> <span class="fu">lm_bootstrap</span>(KC_data, range_body_model, <span class="at">m =</span> <span class="st">"Log_HomeRange_km2 ~ Log_Body_mass_female_mean"</span>, <span class="at">n =</span> i)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  values_for_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">n_boot =</span> i, <span class="co"># Add the values obtained into a single row data frame. We need to rearrange the results becuase the function yields some different orders</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">beta_coef =</span> boot_results[<span class="dv">1</span>,<span class="dv">3</span>],</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lower_CI =</span> boot_results[<span class="dv">3</span>,<span class="dv">3</span>],</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">upper_CI =</span> boot_results[<span class="dv">4</span>,<span class="dv">3</span>])</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  graph_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(graph_df, values_for_df) <span class="co"># Add the single row data frame into the larger dataframe</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(graph_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  n_boot beta_coef  lower_CI upper_CI
1     10  1.051660 0.4933754 1.726979
2     20  1.051238 0.4936189 1.726959
3     30  1.054362 0.4938624 1.728772
4     40  1.055271 0.4941059 1.733477
5     50  1.053310 0.4817417 1.732001
6     60  1.055073 0.4854238 1.735774</code></pre>
</div>
</div>
<p>Time to plot!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> graph_df, <span class="fu">aes</span>(<span class="at">x =</span> n_boot)) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I wanted to plot all the required variables in one figure, so instead of adding y = in the line above, I did it for each geom_point()!</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plotting the Beta coefficient</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> beta_coef, <span class="at">color =</span> <span class="st">"β coefficient"</span>)) <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot Lower CI </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> lower_CI, <span class="at">color =</span> <span class="st">"Lower CI"</span>)) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot Upper CI with Color Inside aes()</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> upper_CI, <span class="at">color =</span> <span class="st">"Upper CI"</span>)) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Since the beta coefficient and the CI values from the original lm will always remain the same, I decided to make it a horizontal line </span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">coef</span>(range_body_model)[[<span class="dv">2</span>]], <span class="at">color =</span> <span class="st">"Original β coefficient"</span>),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line for lower CI</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> ci_beta[[<span class="dv">1</span>]], <span class="at">color =</span> <span class="st">"Original Lower CI"</span>),</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line for upper CI</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> ci_beta[[<span class="dv">2</span>]], <span class="at">color =</span> <span class="st">"Original Upper CI"</span>),</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set Y-Axis Limits to see everything more spaced out</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding labels</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bootstrapped LM vs Base LM"</span>, </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"# of Bootstraps"</span>, </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Values"</span>,</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Legend"</span>) <span class="sc">+</span>  </span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We can use this method to assign different colors to our values so we can plot them all together in one graph!</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"β coefficient"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Lower CI"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Upper CI"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>,</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Original β coefficient"</span> <span class="ot">=</span> <span class="st">"pink"</span>,</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Original Lower CI"</span> <span class="ot">=</span> <span class="st">"lightgreen"</span>,</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Original Upper CI"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>),</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Upper CI"</span>, <span class="st">"Original Upper CI"</span>, <span class="co"># We can use the limits argument to set our out legend title order!</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"β coefficient"</span>, <span class="st">"Original β coefficient"</span>,</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Lower CI"</span>, <span class="st">"Original Lower CI"</span>)) <span class="sc">+</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cmei24_FinalHomeworkCode_05_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="five-challenges-faced" class="level2">
<h2 class="anchored" data-anchor-id="five-challenges-faced">Five Challenges Faced</h2>
<ol type="1">
<li>I didn’t really struggle with the main assignment once I understood what was being asked of me but it was hard for me to understand the question. This tells me about the deficiencies that I have when it comes to the conceptual ideas asked of me. I understand it now!</li>
<li>Struggled with argument m in the EXTRA CREDIT function since I didn’t know I would need to turn it into a formula first using <code>as.formula()</code></li>
<li>In the EXTRA EXTRA CREDIT section I found it hard to think of an efficient way to put everything in the same table for ease of graphing it out later! Glad I figured it out though!</li>
<li>The hardest part was to learn how to plot all the points from the EXTRA EXTRA CREDIT table onto my scatterplot. I learned that I can include the aes(y = ) in other areas other than the initial ggplot starting line.</li>
<li>Learning how to correctly set up my Legend. However, with online help I was able to figure out how these things work!</li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>